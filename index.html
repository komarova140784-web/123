<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–•–û–ó–Ø–ï–í–ê EMPIRE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
@import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

/* ==================== */
/* DARK THEME ENHANCEMENTS */
/* ==================== */

:root {
  /* –¢–µ–º–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ */
  --bg-primary: #0a0a0f;
  --bg-secondary: #141420;
  --bg-tertiary: #1e1e2f;
  --bg-card: rgba(25, 25, 40, 0.8);
  --bg-glass: rgba(30, 30, 50, 0.7);
  
  /* –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
  --gradient-primary: linear-gradient(135deg, #8b5cf6, #6366f1);
  --gradient-secondary: linear-gradient(135deg, #ec4899, #8b5cf6);
  --gradient-dark: linear-gradient(135deg, #1e1b4b, #312e81);
  --gradient-glow: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(99, 102, 241, 0.3));
  
  /* –ù–µ–æ–Ω–æ–≤—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã */
  --neon-purple: #8b5cf6;
  --neon-pink: #ec4899;
  --neon-blue: #6366f1;
  --neon-cyan: #06b6d4;
  
  /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–µ–Ω–∏ —Å –Ω–µ–æ–Ω–æ–≤—ã–º —Å–≤–µ—á–µ–Ω–∏–µ–º */
  --shadow-glow: 0 0 20px rgba(139, 92, 246, 0.3);
  --shadow-glow-lg: 0 0 40px rgba(139, 92, 246, 0.4);
  --shadow-glow-xl: 0 0 60px rgba(139, 92, 246, 0.5);
  
  /* –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
  --glass-border: rgba(139, 92, 246, 0.2);
  --glass-highlight: rgba(255, 255, 255, 0.05);
}

/* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω */
body {
  background: var(--bg-primary);
  color: #e2e8f0;
  background-image: 
    radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 40%),
    radial-gradient(circle at 80% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 40%);
  min-height: 100vh;
}

/* ==================== */
/* GLASS MORPHISM CARDS */
/* ==================== */

.card {
  background: var(--bg-glass);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid var(--glass-border);
  border-radius: 24px;
  padding: 32px;
  margin-bottom: var(--section-spacing);
  position: relative;
  overflow: hidden;
  transition: var(--transition-normal);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.3),
    var(--shadow-glow);
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, 
    transparent, 
    var(--neon-purple), 
    var(--neon-pink),
    transparent);
  animation: borderFlow 3s linear infinite;
}

.card:hover {
  transform: translateY(-8px);
  box-shadow: 
    0 16px 48px rgba(0, 0, 0, 0.4),
    var(--shadow-glow-lg);
  border-color: rgba(139, 92, 246, 0.4);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü—ã */
@keyframes borderFlow {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

/* ==================== */
/* NEON HEADERS */
/* ==================== */

.card h2 {
  position: relative;
  padding-bottom: 16px;
  margin-bottom: 32px;
  font-size: 28px;
  font-weight: 800;
  letter-spacing: -0.01em;
  color: transparent;
  background: linear-gradient(135deg, #ffffff, #a5b4fc);
  -webkit-background-clip: text;
  background-clip: text;
  text-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
}

.card h2::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 80px;
  height: 4px;
  background: var(--gradient-primary);
  border-radius: 4px;
  box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* ==================== */
/* GLOWING INFO ROWS */
/* ==================== */

.info-row {
  position: relative;
  padding: 20px 24px;
  background: rgba(30, 30, 50, 0.5);
  border-radius: 16px;
  border-left: 4px solid transparent;
  transition: var(--transition-normal);
  margin-bottom: 16px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.info-row:hover {
  background: rgba(40, 40, 60, 0.6);
  border-left-color: var(--neon-purple);
  transform: translateX(8px);
  box-shadow: 
    inset 4px 0 0 var(--neon-purple),
    0 0 20px rgba(139, 92, 246, 0.2);
}

.info-row strong {
  color: #c7d2fe;
  font-weight: 600;
  display: inline-block;
  min-width: 240px;
  position: relative;
  padding-left: 32px;
}

.info-row strong::before {
  content: '‚ú®';
  position: absolute;
  left: 0;
  font-size: 18px;
  animation: sparkle 2s ease-in-out infinite;
}

@keyframes sparkle {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.7; transform: scale(1.1); }
}

/* ==================== */
/* NEON AVATAR */
/* ==================== */

.avatar {
  width: 160px;
  height: 160px;
  border-radius: 30%;
  position: relative;
  border: none;
  padding: 4px;
  background: var(--gradient-primary);
  transition: var(--transition-normal);
  box-shadow: 
    0 0 40px rgba(139, 92, 246, 0.4),
    inset 0 0 20px rgba(255, 255, 255, 0.1);
}

.avatar::before {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: 32%;
  background: var(--gradient-secondary);
  z-index: -1;
  animation: rotate 4s linear infinite;
  opacity: 0;
  transition: var(--transition-normal);
}

.avatar:hover::before {
  opacity: 1;
}

.avatar:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 
    0 0 60px rgba(139, 92, 246, 0.6),
    inset 0 0 30px rgba(255, 255, 255, 0.2);
}

@keyframes rotate {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.avatar img {
  width: 100%;
  height: 100%;
  border-radius: 28%;
  object-fit: cover;
  position: relative;
  z-index: 1;
}

/* ==================== */
/* GLOWING BADGES */
/* ==================== */

.badge {
  padding: 8px 18px;
  border-radius: 24px;
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 0.03em;
  text-transform: uppercase;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
  border: 1px solid transparent;
  animation: badgeGlow 3s ease-in-out infinite;
}

.badge::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(45deg, 
    transparent 30%, 
    rgba(255, 255, 255, 0.1), 
    transparent 70%);
  animation: shimmer 3s ease-in-out infinite;
}

.badge.vip {
  background: linear-gradient(135deg, #fcd34d, #f59e0b);
  color: #000;
  border-color: #f59e0b;
  text-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
}

.badge.rank {
  background: linear-gradient(135deg, var(--neon-purple), var(--neon-blue));
  color: white;
  border-color: var(--neon-purple);
}

.badge.admin {
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  border-color: #10b981;
}

@keyframes badgeGlow {
  0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
  50% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.6); }
}

/* ==================== */
/* NEON BUTTONS */
/* ==================== */

.btn {
  position: relative;
  padding: 16px 32px;
  border-radius: 16px;
  font-weight: 600;
  letter-spacing: 0.03em;
  background: var(--gradient-primary);
  border: none;
  overflow: hidden;
  transition: var(--transition-normal);
  color: white;
  backdrop-filter: blur(10px);
  isolation: isolate;
}

.btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--gradient-secondary);
  opacity: 0;
  transition: opacity 0.3s;
  z-index: -1;
}

.btn::after {
  content: '';
  position: absolute;
  inset: -2px;
  background: var(--gradient-primary);
  z-index: -2;
  border-radius: 18px;
  filter: blur(10px);
  opacity: 0;
  transition: opacity 0.3s;
}

.btn:hover::before {
  opacity: 1;
}

.btn:hover::after {
  opacity: 0.6;
}

.btn:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 
    0 12px 32px rgba(139, 92, 246, 0.4),
    0 0 40px rgba(139, 92, 246, 0.3);
}

.btn:active {
  transform: translateY(-2px) scale(1);
  transition: var(--transition-fast);
}

.btn span {
  position: relative;
  z-index: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

/* ==================== */
/* ANIMATED LIST ITEMS */
/* ==================== */

.peer-item {
  background: rgba(40, 40, 60, 0.5);
  border: 1px solid rgba(139, 92, 246, 0.1);
  border-radius: 20px;
  padding: 24px;
  margin-bottom: 16px;
  transition: var(--transition-normal);
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
  animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  opacity: 0;
  transform: translateY(30px);
}

.peer-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg,
    transparent,
    rgba(255, 255, 255, 0.1),
    transparent);
  transition: left 0.8s;
}

.peer-item:hover::before {
  left: 100%;
}

.peer-item:hover {
  background: rgba(50, 50, 70, 0.6);
  border-color: var(--neon-purple);
  transform: translateY(-6px);
  box-shadow: 
    0 12px 32px rgba(0, 0, 0, 0.3),
    0 0 30px rgba(139, 92, 246, 0.2);
}

@keyframes slideInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ==================== */
/* GLOWING CHARTS */
/* ==================== */

.chart-container {
  background: rgba(25, 25, 40, 0.6);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  padding: 24px;
  margin-top: 24px;
  border: 1px solid var(--glass-border);
  position: relative;
  overflow: hidden;
}

.chart-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--gradient-primary);
  animation: chartGlow 4s ease-in-out infinite;
}

@keyframes chartGlow {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 1; }
}

/* ==================== */
/* NEON MODALS */
/* ==================== */

.modal-content {
  background: rgba(20, 20, 35, 0.95);
  backdrop-filter: blur(40px) saturate(200%);
  -webkit-backdrop-filter: blur(40px) saturate(200%);
  border-radius: 32px;
  box-shadow: 
    0 32px 80px rgba(0, 0, 0, 0.5),
    var(--shadow-glow-xl);
  border: 1px solid var(--glass-border);
  animation: modalAppear 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.modal-content::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 50% 0%, 
    rgba(139, 92, 246, 0.1) 0%, 
    transparent 50%);
  pointer-events: none;
}

@keyframes modalAppear {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(40px);
    filter: blur(10px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
    filter: blur(0);
  }
}

/* ==================== */
/* GLOWING RADIO INPUTS */
/* ==================== */

.radio-inputs {
  background: rgba(30, 30, 50, 0.6);
  border-radius: 20px;
  padding: 8px;
  box-shadow: 
    inset 0 2px 4px rgba(0, 0, 0, 0.3),
    var(--shadow-glow);
  border: 1px solid var(--glass-border);
  backdrop-filter: blur(10px);
}

.radio-inputs .radio .name {
  border-radius: 16px;
  padding: 16px 28px;
  font-weight: 600;
  background: transparent;
  border: 2px solid transparent;
  transition: var(--transition-normal);
  color: #a5b4fc;
  position: relative;
  overflow: hidden;
}

.radio-inputs .radio input:checked + .name {
  background: var(--gradient-primary);
  color: white;
  box-shadow: 
    0 8px 24px rgba(139, 92, 246, 0.4),
    inset 0 2px 8px rgba(255, 255, 255, 0.1);
  border-color: transparent;
  animation: radioSelect 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes radioSelect {
  0% { transform: scale(0.95); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* ==================== */
/* GLOWING STATUS */
/* ==================== */

.user-status {
  padding: 8px 20px;
  border-radius: 24px;
  font-weight: 600;
  font-size: 14px;
  letter-spacing: 0.04em;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
  border: 1px solid transparent;
}

.status-online {
  background: var(--gradient-success);
  color: white;
  border-color: #10b981;
  animation: statusPulse 2s ease-in-out infinite;
}

.status-offline {
  background: linear-gradient(135deg, #4b5563, #374151);
  color: #d1d5db;
  border-color: #4b5563;
}

@keyframes statusPulse {
  0%, 100% { 
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); 
  }
  50% { 
    box-shadow: 0 0 30px rgba(16, 185, 129, 0.6); 
  }
}

/* ==================== */
/* GLOWING DAY TABS */
/* ==================== */

.days-tabs {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  background: rgba(30, 30, 50, 0.5);
  padding: 16px;
  border-radius: 24px;
  margin-bottom: 32px;
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
}

.day-tab {
  padding: 12px 24px;
  border-radius: 20px;
  background: rgba(40, 40, 60, 0.6);
  border: 2px solid rgba(139, 92, 246, 0.2);
  color: #a5b4fc;
  font-weight: 600;
  transition: var(--transition-normal);
  position: relative;
  overflow: hidden;
}

.day-tab::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--gradient-primary);
  opacity: 0;
  transition: opacity 0.3s;
  z-index: -1;
}

.day-tab.active::before {
  opacity: 1;
}

.day-tab.active {
  color: white;
  border-color: transparent;
  box-shadow: 
    0 8px 24px rgba(139, 92, 246, 0.4),
    0 0 20px rgba(139, 92, 246, 0.3);
  animation: tabBounce 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.day-tab:hover:not(.active) {
  background: rgba(50, 50, 70, 0.8);
  border-color: var(--neon-purple);
  transform: translateY(-4px);
  box-shadow: 0 4px 20px rgba(139, 92, 246, 0.2);
}

@keyframes tabBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

/* ==================== */
/* GLOWING LOG ITEMS */
/* ==================== */

.log-item {
  background: rgba(30, 30, 50, 0.5);
  border-radius: 20px;
  padding: 24px;
  margin-bottom: 16px;
  border-left: 6px solid var(--neon-purple);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  transition: var(--transition-normal);
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
  animation: logSlideIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  opacity: 0;
  transform: translateX(-20px);
}

.log-item::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, 
    rgba(139, 92, 246, 0.1) 0%,
    transparent 50%);
  opacity: 0;
  transition: opacity 0.3s;
}

.log-item:hover::after {
  opacity: 1;
}

.log-item:hover {
  transform: translateX(12px);
  box-shadow: 
    0 12px 32px rgba(0, 0, 0, 0.3),
    0 0 30px rgba(139, 92, 246, 0.2);
}

@keyframes logSlideIn {
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* –¢–∏–ø—ã –ª–æ–≥–æ–≤ */
.log-item.finance {
  border-left-color: #10b981;
  background: linear-gradient(135deg, 
    rgba(16, 185, 129, 0.1),
    rgba(30, 30, 50, 0.5));
}

.log-item.system {
  border-left-color: #3b82f6;
  background: linear-gradient(135deg, 
    rgba(59, 130, 246, 0.1),
    rgba(30, 30, 50, 0.5));
}

.log-item.error {
  border-left-color: #ef4444;
  background: linear-gradient(135deg, 
    rgba(239, 68, 68, 0.1),
    rgba(30, 30, 50, 0.5));
}

/* ==================== */
/* NEON LOADER */
/* ==================== */

.loading-indicator {
  background: rgba(25, 25, 40, 0.9);
  border-radius: 32px;
  padding: 60px;
  box-shadow: 
    var(--shadow-glow-xl),
    inset 0 2px 8px rgba(255, 255, 255, 0.05);
  border: 1px solid var(--glass-border);
  backdrop-filter: blur(40px);
  position: relative;
  overflow: hidden;
}

.loading-indicator::before {
  content: '';
  position: absolute;
  inset: 0;
  background: conic-gradient(
    from 0deg,
    transparent,
    var(--neon-purple),
    var(--neon-pink),
    var(--neon-purple),
    transparent
  );
  animation: rotate 3s linear infinite;
}

.loading-indicator > * {
  position: relative;
  z-index: 1;
}

.spinner {
  border: 4px solid transparent;
  border-top: 4px solid var(--neon-purple);
  border-right: 4px solid var(--neon-pink);
  border-bottom: 4px solid var(--neon-blue);
  border-radius: 50%;
  width: 80px;
  height: 80px;
  animation: spin 1.5s cubic-bezier(0.4, 0, 0.2, 1) infinite;
  position: relative;
}

.spinner::before {
  content: '';
  position: absolute;
  inset: -6px;
  border: 2px solid var(--neon-purple);
  border-radius: 50%;
  animation: pulseRing 2s ease-in-out infinite;
}

@keyframes pulseRing {
  0%, 100% { 
    opacity: 0.3; 
    transform: scale(0.95);
  }
  50% { 
    opacity: 1; 
    transform: scale(1.05);
  }
}

/* ==================== */
/* NEON HEADER */
/* ==================== */

header {
  background: rgba(15, 15, 25, 0.8);
  backdrop-filter: blur(40px) saturate(200%);
  -webkit-backdrop-filter: blur(40px) saturate(200%);
  height: 80px;
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
  border-bottom: 1px solid var(--glass-border);
}

.logo {
  width: 48px;
  height: 48px;
  background: var(--gradient-primary);
  border-radius: 16px;
  box-shadow: 
    0 8px 24px rgba(139, 92, 246, 0.4),
    inset 0 2px 4px rgba(255, 255, 255, 0.2);
  position: relative;
  overflow: hidden;
  animation: logoFloat 6s ease-in-out infinite;
}

@keyframes logoFloat {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-10px) rotate(5deg); }
}

/* ==================== */
/* GLOWING FORM INPUTS */
/* ==================== */

.form-input,
.form-input-modal,
.form-select-modal {
  background: rgba(40, 40, 60, 0.6);
  border: 2px solid rgba(139, 92, 246, 0.2);
  border-radius: 16px;
  padding: 16px 20px;
  font-size: 16px;
  transition: var(--transition-normal);
  color: #e2e8f0;
  backdrop-filter: blur(10px);
  box-shadow: 
    inset 0 2px 4px rgba(0, 0, 0, 0.2),
    0 0 0 rgba(139, 92, 246, 0);
}

.form-input:focus,
.form-input-modal:focus,
.form-select-modal:focus {
  background: rgba(50, 50, 70, 0.8);
  border-color: var(--neon-purple);
  box-shadow: 
    0 0 0 4px rgba(139, 92, 246, 0.1),
    inset 0 2px 4px rgba(0, 0, 0, 0.2),
    0 0 20px rgba(139, 92, 246, 0.2);
  outline: none;
  animation: inputFocus 0.3s ease-out;
}

@keyframes inputFocus {
  from {
    box-shadow: 
      0 0 0 0 rgba(139, 92, 246, 0.2),
      inset 0 2px 4px rgba(0, 0, 0, 0.2);
  }
}

/* ==================== */
/* PARTICLE BACKGROUND */
/* ==================== */

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: 
    radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
  pointer-events: none;
  z-index: -1;
  animation: bgFloat 20s ease-in-out infinite;
}

@keyframes bgFloat {
  0%, 100% { transform: translate(0, 0); }
  25% { transform: translate(-20px, -20px); }
  50% { transform: translate(20px, 20px); }
  75% { transform: translate(-20px, 20px); }
}

/* ==================== */
/* SCROLLBAR STYLING */
/* ==================== */

::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: rgba(30, 30, 50, 0.3);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--gradient-primary);
  border-radius: 10px;
  border: 2px solid rgba(15, 15, 25, 0.3);
  animation: scrollThumbGlow 3s ease-in-out infinite;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--gradient-secondary);
}

@keyframes scrollThumbGlow {
  0%, 100% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }
  50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.8); }
}

/* ==================== */
/* FLOATING PARTICLES */
/* ==================== */

.particle {
  position: fixed;
  pointer-events: none;
  z-index: -1;
  animation: floatParticle linear infinite;
}

@keyframes floatParticle {
  to {
    transform: translateY(-100vh) rotate(360deg);
  }
}

/* ==================== */
/* RESPONSIVE ENHANCEMENTS */
/* ==================== */

@media (max-width: 768px) {
  :root {
    --section-spacing: 20px;
  }
  
  .card {
    padding: 24px;
    border-radius: 20px;
    margin: 0 16px 20px;
  }
  
  .card h2 {
    font-size: 24px;
  }
  
  .avatar {
    width: 120px;
    height: 120px;
  }
  
  .btn {
    padding: 14px 24px;
  }
  
  .modal-content {
    margin: 10% 16px;
    width: auto;
  }
  
  /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º—ã—Ç–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
  .card,
  .modal-content,
  header {
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }
}

/* ==================== */
/* CUSTOM CURSOR */
/* ==================== */

* {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='8' fill='%238b5cf6' opacity='0.7'/%3E%3Ccircle cx='16' cy='16' r='4' fill='white'/%3E%3C/svg%3E") 16 16, auto;
}

a, button, .btn, .peer-button {
  cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='12' fill='%23ec4899' opacity='0.7'/%3E%3Ccircle cx='16' cy='16' r='6' fill='white'/%3E%3C/svg%3E") 16 16, pointer;
}

/* ==================== */
/* TOAST NOTIFICATIONS */
/* ==================== */

.toast {
  background: rgba(30, 30, 50, 0.9);
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-left: 4px solid var(--neon-purple);
  animation: toastSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.4),
    var(--shadow-glow);
}

.toast.success {
  border-left-color: #10b981;
  background: linear-gradient(135deg, 
    rgba(16, 185, 129, 0.2),
    rgba(30, 30, 50, 0.9));
}

.toast.error {
  border-left-color: #ef4444;
  background: linear-gradient(135deg, 
    rgba(239, 68, 68, 0.2),
    rgba(30, 30, 50, 0.9));
}

@keyframes toastSlideIn {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ==================== */
/* HOVER EFFECTS */
/* ==================== */

.hover-lift {
  transition: var(--transition-normal);
}

.hover-lift:hover {
  transform: translateY(-4px);
}

.hover-glow {
  transition: var(--transition-normal);
}

.hover-glow:hover {
  box-shadow: var(--shadow-glow-lg);
}

.hover-scale {
  transition: var(--transition-normal);
}

.hover-scale:hover {
  transform: scale(1.05);
}

/* ==================== */
/* GRADIENT TEXT */
/* ==================== */

.gradient-text {
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.gradient-text-secondary {
  background: var(--gradient-secondary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* ==================== */
/* FINAL TOUCHES */
/* ==================== */

::selection {
  background: rgba(139, 92, 246, 0.4);
  color: white;
  text-shadow: none;
}

::-moz-selection {
  background: rgba(139, 92, 246, 0.4);
  color: white;
  text-shadow: none;
}

/* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª —Å –ø–∞—Ä–∞–ª–ª–∞–∫—Å–æ–º */
* {
  scroll-behavior: smooth;
  scroll-padding-top: 100px;
}

/* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
  </style>
</head>
<body>
  <div id="toastContainer"></div>
<header>
<div class="profile-dropdown">
    <div class="profile-icon" aria-label="–ú–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è" id="profileMenu">
    <img src="profile-icon.jpg" alt="–õ–æ–≥–æ—Ç–∏–ø —Å–∞–π—Ç–∞" style="width: 38px; height: 38px; border-radius: 30%;">
    </div>
</header>
<div class="container">
  <div class="radio-inputs">
    <label class="radio">
      <input type="radio" name="radio" <?php echo $active_section === 'profile' ? 'checked' : ''; ?> data-section="profile">
      <span class="name">–ü—Ä–æ—Ñ–∏–ª—å</span>
    </label>

    <label class="radio">
      <input type="radio" name="radio" <?php echo $active_section === 'groups' ? 'checked' : ''; ?> data-section="groups">
      <span class="name">–ë–µ—Å–µ–¥—ã</span>
    </label>

    <label class="radio">
      <input type="radio" name="radio" <?php echo $active_section === 'panel' ? 'checked' : ''; ?> data-section="panel">
      <span class="name">–ü–∞–Ω–µ–ª—å</span>
</label>
  </div>   
</div>

    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-indicator">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>
    </div>

    <section id="profile-section" class="content-section <?php echo $active_section === 'profile' ? 'active' : ''; ?>">
        <?php if ($from_id && $site): ?>
            <div class="card" aria-labelledby="user-info-title">
                <h2 id="user-info-title">
                    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                </h2>
                
                <div class="user-profile">
                    <div class="avatar-container">
                        <img src="<?php 
                            if (intval($site['avatar_url']) == 1) {
                                $avatar = "profile-icon.jpg"; 
                            } else {
                                $avatar = $site['avatar_url'];
                            } 
                            echo $avatar; 
                        ?>" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" class="avatar">
                        
                        <?php
                        $vip_name = [
                            1 => "DEF –•–æ–∑—è–µ–Ω—ë–Ω–æ–∫",
                            2 => "VIP –•–æ–∑—è–µ–Ω—ë–Ω–æ–∫",
                            3 => "PREMIUM –•–æ–∑—è–µ–Ω—ë–Ω–æ–∫",
                        ];
                        $vip = $vip_name[$site['vip'] ?? 0] ?? false;
                        if ($vip): ?>
                        <span class="badge vip"><?php echo $vip; ?></span>
                        <?php endif; ?>
                    </div>
                    
                    <div class="user-info">
                        <div class="info-row">
                            <strong>–ù–∏–∫ –≤ —Å–∏—Å—Ç–µ–º–µ:</strong><br>
                            <?php echo htmlspecialchars($site['Text'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω'); ?>
                        </div>
                        
                        <div class="info-row">
                            <strong>–ü—Ä–∞–≤–∞ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</strong><br>
                            <?php
                            $admin_names = [
                                0 => "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                                1 => "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
                                2 => "–°—É–ø–µ—Ä-–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
                            ];
                            $admin_text = $admin_names[$site['is_admin'] ?? 0] ?? "–û—à–∏–±–∫–∞";
                            echo $admin_text;
                            ?>
                        </div>
                        
                        <div class="info-row">
                            <strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong><br>
                            @<?php echo htmlspecialchars($site['username'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω'); ?>
                        </div>
                        
                        <div class="info-row">
                            <strong>ID:</strong><br>
                            <?php echo htmlspecialchars($site['tg_id'] ?? '–ù–µ —É–∫–∞–∑–∞–Ω'); ?>
                        </div>
                        
                        <div class="info-row">
                            <strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–ø–µ–π:</strong><br> 
                            <?php echo htmlspecialchars($site['cep'] ?? '0'); ?>
                        </div>
                        
                        <div class="info-row">
                            <strong>–†–∞–Ω–≥ –≤ —Å–∏—Å—Ç–µ–º–µ:</strong> <br>
                            <?php
                            $rank_names = [
                                3 => "üîß –•–æ–∑—è–µ—Ç—Ä—É–¥–Ω–∏–∫",
                                4 => "üõ°Ô∏è –•–æ–∑—è–µ—Å—Ç—Ä–∞–∂",
                                5 => "üéì –•–æ–∑—è–µ–º–∞—Å—Ç–µ—Ä",
                                7 => "üë∂ –ü—É–ø—Å–∏–∫",
                                8 => "üí∞ $ –ú–∞–∂–æ—Ä $",
                                9 => "üëî –ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å",
                                10 => "üëë –ì–ª.–•–û–ó–Ø–ò–ù",
                                11 => "üë§ –ì–ª.–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å",
                            ];
                            $rank_name = $rank_names[$site['rang'] ?? 0] ?? "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π";
                            echo $rank_name;
                            ?>
                            <span class="badge rank">–†–∞–Ω–≥</span>
                        </div>
                        
                        <div class="info-row">
                            <strong>–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è:</strong><br>
                            <?php
                            $months = [
                                1 => '—è–Ω–≤–∞—Ä—è', 2 => '—Ñ–µ–≤—Ä–∞–ª—è', 3 => '–º–∞—Ä—Ç–∞', 4 => '–∞–ø—Ä–µ–ª—è', 5 => '–º–∞—è', 6 => '–∏—é–Ω—è',
                                7 => '–∏—é–ª—è', 8 => '–∞–≤–≥—É—Å—Ç–∞', 9 => '—Å–µ–Ω—Ç—è–±—Ä—è', 10 => '–æ–∫—Ç—è–±—Ä—è', 11 => '–Ω–æ—è–±—Ä—è', 12 => '–¥–µ–∫–∞–±—Ä—è'
                            ];
                            if (!$bday) {
                                $birth = '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                            } else {
                                if (strpos($bday['birthday'], '.') !== false && strlen($bday['birthday']) == 5) {
                                    $bday['birthday'] .= '.' . date('Y');
                                }
                                $date = strtotime($bday['birthday']);
                                if ($date === false) {
                                    echo '–û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã!';
                                } else {
                                    $day = date('j', $date);
                                    $monthNumber = (int)date('m', $date);
                                    $month = $months[$monthNumber];
                                    $birth = $day . ' ' . $month;
                                    $birth = mb_convert_case($birth, MB_CASE_TITLE, 'UTF-8');
                                }
                            }

                            echo $birth;
                            ?>
                        </div>
                        <div class="info-row">
                            <strong>–í–∞—à –≥–æ—Ä–æ–¥:</strong><br>
                            <?php
                            echo $site['city'] ?? '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                            ?>
                        </div>
                     <button type="button" class="btn warning" onclick="window.location.href='/map'">
    –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ä—Ç—É
</button>
                    </div>
                </div>
            </div>

            <section class="card" aria-labelledby="balances-title">
                <h2 id="balances-title">
                    –í–∞—à–∏ –±–∞–ª–∞–Ω—Å—ã
                </h2>
                
                <div class="info-row">
                    <strong>Hozyaecoin:</strong> 
                    <?php echo number_format($site['money'] ?? 0, 0, ".", ","); ?> ¬£ hoz
                </div>
                <div class="info-row" style="margin-top:12px;">
                    <strong>üëæ BTC:</strong> 
                    <?php echo number_format($site['btc'] ?? 0, 0, ".", ","); ?> 
                </div>
                <div class="info-row" style="margin-top:12px;">
                    <strong>üé© ETH:</strong> 
                    <?php echo number_format($site['eth'] ?? 0, 0, ".", ","); ?> 
                </div>
                <div class="info-row" style="margin-top:12px;">
                    <strong>üëæ TON:</strong> 
                    <?php echo number_format($site['ton'] ?? 0, 0, ".", ","); ?> 
                </div>
            </section>
            <section class="card" aria-labelledby="balances-title">
                <h2 id="balances-title">
                    ü§µüèª –•üÖæÔ∏è–ó–Ø–ï–íüÖ∞Ô∏è | –úüÖ∞Ô∏è–§–ò–Ø
                </h2>
                
                <div class="info-row" style="margin-top:12px;">
                    <strong>üíé –ö–∞–º–Ω–µ–π:</strong> 
                    <?php echo number_format($site['kamni'] ?? 0, 0, ".", ","); ?> 
                </div>
                <div class="info-row" style="margin-top:12px;">
                    <strong>üíµ –î–µ–Ω—å–≥–∏:</strong> 
                    <?php echo number_format($site['moneymaf'] ?? 0, 0, ".", ","); ?> 
                </div>
                <div class="info-row" style="margin-top:12px;">
                    <strong>üõ° –ó–∞—â–∏—Ç–∞:</strong> 
                    <?php echo number_format($site['maf_protect'] ?? 0, 0, ".", ","); ?> 
                </div>
                <div class="info-row" style="margin-top:12px;">
                    <strong>üìë –î–æ–∫—É–º–µ–Ω—Ç—ã:</strong> 
                    <?php echo number_format($site['maf_doc'] ?? 0, 0, ".", ","); ?> 
                </div>
                <div class="info-row" style="margin-top:12px;">
                    <strong>üéé –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–æ–ª—å:</strong> 
                    <?php echo number_format($site['maf_activerole'] ?? 0, 0, ".", ","); ?> 
                </div>
            </section>

            <section class="card" aria-labelledby="property-title">
                <h2 id="property-title">
                    –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∏ –∏–º—É—â–µ—Å—Ç–≤–æ
                </h2>
                
                <div class="balances-property">
                    <div class="property-grid">
                        <div class="info-row"><strong>–ê–≤—Ç–æ–º–æ–±–∏–ª—å:</strong><br> <?php echo !empty($site['cars']) ? htmlspecialchars($site['cars']) : '–ù–µ—Ç—É'; ?></div>
                        <div class="info-row"><strong>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å:</strong><br> <?php echo !empty($site['houses']) ? htmlspecialchars($site['houses']) : '–ù–µ—Ç—É'; ?></div>
                        <div class="info-row"><strong>–Ø—Ö—Ç–∞:</strong><br> <?php echo !empty($site['yachts']) ? htmlspecialchars($site['yachts']) : '–ù–µ—Ç—É'; ?></div>
                        <div class="info-row"><strong>–°–∞–º–æ–ª–µ—Ç:</strong><br> <?php echo !empty($site['planes']) ? htmlspecialchars($site['planes']) : '–ù–µ—Ç—É'; ?></div>
                        <div class="info-row"><strong>–í–µ—Ä—Ç–æ–ª–µ—Ç:</strong><br> <?php echo !empty($site['helicopters']) ? htmlspecialchars($site['helicopters']) : '–ù–µ—Ç—É'; ?></div>
                        <div class="info-row"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong><br> <?php echo !empty($site['phones']) ? htmlspecialchars($site['phones']) : '–ù–µ—Ç—É'; ?></div>
                        <div class="info-row"><strong>–ö–æ–º–ø—å—é—Ç–µ—Ä:</strong><br> <?php echo !empty($site['pcs']) ? htmlspecialchars($site['pcs']) : '–ù–µ—Ç—É'; ?></div>
                    </div>

                    <hr>

                    <div class="property-grid">
                        <h3>üíº –ë–∏–∑–Ω–µ—Å—ã</h3>
                        <?php
                        $businesses = [
                            "bukmek"=>["name"=>"–ë—É–∫–º–µ–∫–µ—Ä—Å–∫–∞—è –∫–æ–Ω—Ç–æ—Ä–∞"],
                            "magazin"=>["name"=>"–ú–∞–≥–∞–∑–∏–Ω"],
                            "kafe"=>["name"=>"–ö–∞—Ñ–µ"],
                            "restoran"=>["name"=>"–†–µ—Å—Ç–æ—Ä–∞–Ω"],
                            "bar"=>["name"=>"–ë–∞—Ä"],
                            "nightclub"=>["name"=>"–ù–æ—á–Ω–æ–π –∫–ª—É–±"],
                            "autoshop"=>["name"=>"–ê–≤—Ç–æ–º–∞–≥–∞–∑–∏–Ω"],
                            "cinema"=>["name"=>"–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä"],
                            "hotel"=>["name"=>"–û—Ç–µ–ª—å"],
                            "casino"=>["name"=>"–ö–∞–∑–∏–Ω–æ"]
                        ];

                        $hasBiz = false;
                        foreach ($businesses as $key=>$biz) {
                            if (!empty($site["biz_{$key}"])) {
                                $hasBiz = true;
                                $level = !empty($site["biz_{$key}_level"]) ? $site["biz_{$key}_level"] : 1;
                                echo "<div class='info-row'><strong>{$biz['name']}:</strong> –£—Ä–æ–≤–µ–Ω—å {$level}</div>";
                            }
                        }
                        if (!$hasBiz) {
                            echo "<div class='info-row'>‚ùå –£ –≤–∞—Å –Ω–µ—Ç –±–∏–∑–Ω–µ—Å–æ–≤</div>";
                        }
                        ?>
                    </div>

                    <hr>

                    <div class="property-grid">
                        <h3>üéÅ –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</h3>
                        <?php
                        $accessories = [
                            "nimb"=>"–ù–∏–º–±",
                            "shar"=>"–®–∞—Ä",
                            "bronzovy_medal"=>"–ë—Ä–æ–Ω–∑–æ–≤–∞—è –º–µ–¥–∞–ª—å",
                            "serebryany_medal"=>"–°–µ—Ä–µ–±—Ä—è–Ω–∞—è –º–µ–¥–∞–ª—å",
                            "zolotoy_medal"=>"–ó–æ–ª–æ—Ç–∞—è –º–µ–¥–∞–ª—å",
                            "angel_wings"=>"–ö—Ä—ã–ª—å—è –∞–Ω–≥–µ–ª–∞",
                            "devil_horn"=>"–†–æ–≥–∞ –¥—å—è–≤–æ–ª–∞",
                            "diamond_ring"=>"–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤–æ–µ –∫–æ–ª—å—Ü–æ",
                            "magic_orb"=>"–í–æ–ª—à–µ–±–Ω—ã–π —à–∞—Ä",
                            "crown"=>"–ö–æ—Ä–æ–Ω–∞"
                        ];

                        $hasAcc = false;
                        foreach ($accessories as $key=>$name) {
                            if (!empty($site["acc_{$key}"])) {
                                $hasAcc = true;
                                echo "<div class='info-row'>‚úÖ {$name}</div>";
                            }
                        }
                        if (!$hasAcc) {
                            echo "<div class='info-row'>‚ùå –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤</div>";
                        }
                        ?>
                    </div>
                </div>
            </section>
            
            <section class="card">
                <h2 id="stats-title">
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
                </h2>
                
                <?php
                $total_messages = array_sum($message_counts);
                $average_per_day = $total_messages > 0 ? round($total_messages / 7) : 0;
                $max_per_day = max($message_counts);
                ?>
                
                <div class="stats-summary">
                    <div class="stat-item">
                        <div class="stat-number">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: <?php echo $total_messages; ?></div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">–í —Å—Ä–µ–¥–Ω–µ–º –≤ –¥–µ–Ω—å: <?php echo $average_per_day; ?></div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">–ú–∞–∫—Å–∏–º—É–º –≤ –¥–µ–Ω—å: <?php echo $max_per_day; ?></div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="messageChart"></canvas>
                </div>
            </section>

<?php    
function formatTimeAgo($datetime) {
    $now = new DateTime();
    $date = new DateTime($datetime);
    $diff = $now->diff($date);
    
    if ($diff->days > 7) {
        return date('d.m.Y', strtotime($datetime));
    } elseif ($diff->days > 0) {
        return $diff->days . ' ' . getRussianWord($diff->days, ['–¥–µ–Ω—å', '–¥–Ω—è', '–¥–Ω–µ–π']) . ' –Ω–∞–∑–∞–¥';
    } elseif ($diff->h > 0) {
        return $diff->h . ' ' . getRussianWord($diff->h, ['—á–∞—Å', '—á–∞—Å–∞', '—á–∞—Å–æ–≤']) . ' –Ω–∞–∑–∞–¥';
    } elseif ($diff->i > 0) {
        return $diff->i . ' ' . getRussianWord($diff->i, ['–º–∏–Ω—É—Ç—É', '–º–∏–Ω—É—Ç—ã', '–º–∏–Ω—É—Ç']) . ' –Ω–∞–∑–∞–¥';
    } else {
        return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
    }
}

function getRussianWord($number, $words) {
    $cases = array(2, 0, 1, 1, 1, 2);
    return $words[($number % 100 > 4 && $number % 100 < 20) ? 2 : $cases[min($number % 10, 5)]]; 
}

function getLogCategory($logText) {
    $text = strtolower($logText);
    
    $financeKeywords = ['—Ä–∞–±', '–¥–µ–Ω—å–≥–∏', '–≤—ã–∏–≥—Ä–∞–ª', '–ø—Ä–æ–∏–≥—Ä–∞–ª', '—Å—Ç–∞–≤–∫–∞', '–ø–ª–∞—Ç–µ–∂', '–ø–ª–∞—Ç–µ–∂–∏', '–∫–æ—à–µ–ª–µ–∫', '–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', '–≤—ã–≤–æ–¥', '–ø–æ—Å—Ç–∞–≤–∏–ª', '–±–æ–Ω—É—Å', '–±–∞–ª–∞–Ω—Å', '–±–∏–∑–Ω–µ—Å', '–∞–∫—Å–µ—Å—Å—É–∞—Ä'];
    $systemKeywords = ['—Å–∏—Å—Ç–µ–º–∞', '–∞–¥–º–∏–Ω', '—Ä–∞—Å—Å—ã–ª–∫–∞', '–ø–æ–¥–ø–∏—Å–∫–∞', '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª', '–æ—Ç–∫–ª–æ–Ω–∏–ª', '–æ–¥–æ–±—Ä–∏–ª', '–∑–∞–ø—Ä–æ—Å', '—Å–µ–º–µ–π', '–∫–æ–º–∞–Ω–¥—É', '/st', '—Ä–∞—Å—Å—ã–ª–∫'];

    foreach ($financeKeywords as $keyword) {
        if (strpos($text, $keyword) !== false) {
            return 'finance';
        }
    }

    foreach ($systemKeywords as $keyword) {
        if (strpos($text, $keyword) !== false) {
            return 'system';
        }
    }

    return 'system';
}

function getLogIcon($text) {
    $text = strtolower($text);
    
    if (strpos($text, '–≤ –∫–∞–∑–∏–Ω–æ –∏ –ø—Ä–æ–∏–≥—Ä–∞–ª') !== false || 
        strpos($text, '–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª') !== false ||
        strpos($text, '–æ—Ç–∫–ª–æ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å') !== false ||
        strpos($text, '–æ—Ç–ø–∏—Å–∞–ª—Å—è –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏') !== false) {
        return ['cross', 'activity-icon-red'];
    } elseif (strpos($text, '–∏ –≤—ã–∏–≥—Ä–∞–ª —Å –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º') !== false || 
             strpos($text, '—Ä–∞–±') !== false ||
             strpos($text, '–æ–¥–æ–±—Ä–∏–ª –∑–∞–ø—Ä–æ—Å') !== false ||
             strpos($text, '–≤—ã–¥–∞–ª —Å–µ–º–µ–π') !== false ||
             strpos($text, '–ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É') !== false ||
             strpos($text, '/st') !== false) {
        return ['check', 'activity-icon-green'];
    } elseif (strpos($text, '–∞–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–∏–ª —Ä–∞—Å—Å—ã–ª–∫—É') !== false) {
        return ['message', 'activity-icon-blue'];
    }
    
    return ['message', 'activity-icon-blue'];
}
?>

<!-- –£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω –ª–æ–≥–æ–≤ -->
<div class="logs-container">
    <div class="logs-header">
        <h2>–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</h2>
        <div class="logs-filters">
            <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
            <button class="filter-btn" data-filter="finance">–§–∏–Ω–∞–Ω—Å—ã</button>
            <button class="filter-btn" data-filter="system">–°–∏—Å—Ç–µ–º–∞</button>
        </div>
    </div>

    <div class="days-navigation">
        <div class="days-tabs">
            <?php 
            $first = true;
            foreach ($groupedLogs as $day => $dayLogs): 
                $today = date('Y-m-d');
                $yesterday = date('Y-m-d', strtotime('-1 day'));
                
                if ($day === $today) {
                    $displayName = '–°–µ–≥–æ–¥–Ω—è';
                } elseif ($day === $yesterday) {
                    $displayName = '–í—á–µ—Ä–∞';
                } else {
                    $displayName = date('d.m', strtotime($day));
                }
                
                $financeCount = 0;
                $systemCount = 0;
                foreach ($dayLogs as $log) {
                    $category = getLogCategory($log['log_text']);
                    if ($category === 'finance') $financeCount++;
                    if ($category === 'system') $systemCount++;
                }
            ?>
                <button class="day-tab <?php echo $first ? 'active' : ''; ?>" data-day="<?php echo $day; ?>">
                    <span class="day-name"><?php echo $displayName; ?></span>
                    <span class="day-stats">
                        <span class="finance-count"><?php echo $financeCount; ?></span>/
                        <span class="system-count"><?php echo $systemCount; ?></span>
                    </span>
                </button>
            <?php 
                $first = false;
            endforeach; 
            ?>
        </div>
    </div><br>
    <hr><br>
    
    <div class="logs-timeline">
        <?php foreach ($groupedLogs as $day => $dayLogs): ?>
            <div class="day-activities" data-day="<?php echo $day; ?>" style="<?php echo ($day === date('Y-m-d')) ? '' : 'display:none;'; ?>">
                <div class="day-header">
                    <h3>
                        <?php 
                        $today = date('Y-m-d');
                        $yesterday = date('Y-m-d', strtotime('-1 day'));
                        
                        if ($day === $today) {
                            echo '–°–µ–≥–æ–¥–Ω—è';
                        } elseif ($day === $yesterday) {
                            echo '–í—á–µ—Ä–∞';
                        } else {
                            echo date('d.m.Y', strtotime($day));
                        }
                        ?>
                    </h3>
                    <span class="day-total"><?php echo count($dayLogs); ?> —Å–æ–±—ã—Ç–∏–π</span>
                </div>
                
                <div class="logs-list">
                    <?php foreach ($dayLogs as $log): 
                        $category = getLogCategory($log['log_text']);
                        list($icon, $color_class) = getLogIcon($log['log_text']);
                    ?>
                        <div class="log-item log-timeline-item <?php echo $category; ?>" data-category="<?php echo $category; ?>">
                            <?php if ($icon === 'shield'): ?>
                                <svg class="log-icon <?php echo $color_class; ?>" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                                </svg>
                            <?php elseif ($icon === 'cross'): ?>
                                <svg class="log-icon <?php echo $color_class; ?>" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                </svg>
                            <?php elseif ($icon === 'check'): ?>
                                <svg class="log-icon <?php echo $color_class; ?>" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            <?php else: ?>
                                <svg class="log-icon <?php echo $color_class; ?>" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                                </svg>
                            <?php endif; ?>
                            
                            <div class="log-content">
                                <div class="log-title">
                                    <?php echo $log['log_text']; ?>
                                    <span class="log-category <?php echo $category; ?>">
                                        <?php echo $category === 'finance' ? '–§–∏–Ω–∞–Ω—Å—ã' : '–°–∏—Å—Ç–µ–º–∞'; ?>
                                    </span>
                                </div>
                                <div class="log-time">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                                    </svg>
                                    <?php echo formatTimeAgo($log['created_at']); ?>
                                </div>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
            </div>
        <?php endforeach; ?>
    </div>
</div>

</div>
            </section>
        <?php else: ?>
            <div class="card">
                <h2>–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</h2>
                <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ.</p>
            </div>
        <?php endif; ?>
    </section>
    <section id="groups-section" class="content-section <?php echo $active_section === 'groups' ? 'active' : ''; ?>">
        <?php if ($from_id && $site): ?>
            <section class="card">
                <h2>–ú–æ–∏ –±–µ—Å–µ–¥—ã</h2>
                <div class="peers-list">
                    <?php
                    $stmt = $con->prepare("SELECT peer FROM tg_nlist WHERE tg_id = ?");
                    $stmt->execute([$from_id]);
                    $sites = $stmt->fetchAll(PDO::FETCH_ASSOC);
                    
                    if (count($sites) > 0) {
                        foreach ($sites as $site): 
                            if($site['peer'] == '-1002483132170') {
                                $name = "–•üÖæÔ∏è–ó–Ø–ï–íüÖ∞Ô∏è | BO"; 
                                $owner_name = "s69xüòà";
                                $owner_link = "samp69x";
                            } else {
                                $name = "#–í–û || –•–û–ó–Ø–ï–í–ê || –ú–∞—Å—Å–æ–Ω—ã";
                                $owner_name = "‚Äùdavid‚Äù ü•∂ ";
                                $owner_link = "david_dream";
                            }
                            
                            $stmt = $con->prepare("SELECT date FROM all_message WHERE peer = ? ORDER BY date DESC LIMIT 1");
                            $stmt->execute([$site['peer']]);
                            $lastMessage = $stmt->fetch(PDO::FETCH_ASSOC);
                            
                            $sitepeer = $site['peer'];
                            $response = file_get_contents(
                                "https://api.telegram.org/bot7829579595:AAFYq5Qmo6dA6DA5jn9g2hKn-Uedt6jnB7A/getChatMemberCount?chat_id=$sitepeer"
                            );
                            $data = json_decode($response, true);
                    ?>
                    <div class="peer-item">
                        <img src="/profile-icon.jpg" alt="–ê–≤–∞—Ç–∞—Ä –±–µ—Å–µ–¥—ã" class="peer-avatar">
                        <div class="peer-details">
                            <h3 class="peer-title"><?php echo $name; ?></h3>
                            <div class="peer-meta">
                                <span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                                    </svg>
                                    –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: <?php echo $lastMessage['date']; ?>
                                </span>
                                <span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                    </svg>
                                    –í–ª–∞–¥–µ–ª–µ—Ü: <a href="https://t.me/<?php echo $owner_link; ?>"><?php echo $owner_name; ?></a>
                                </span>
                                <span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                                    </svg>
                                    –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: <?php echo $data["result"]; ?>
                                </span>
                            </div>
                        </div>
                        <div class="peer-actions">
                            <a href="mini-app-infopeer?id=<?php echo urlencode($site['peer']); ?>" class="peer-button">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                                </svg>
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                        </div>
                    </div>
                    <?php endforeach; 
                    } else { ?>
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                        </svg>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ —á—Ç–æ –Ω–µ—Ç—É –±–µ—Å–µ–¥, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ –¥–æ–±–∞–≤–∏—Ç—Å—è :)</p>
                    </div>
                    <?php } ?>
                </div>
            </section>
        <?php else: ?>
            <div class="card">
                <h2>–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</h2>
                <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ.</p>
            </div>
        <?php endif; ?>
    </section>

<section id="panel-section" class="content-section <?php echo $active_section === 'panel' ? 'active' : ''; ?>">
    <section class="card">
        <h2>
            –ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª–∏ –û–Ω–ª–∞–π–Ω
            <span id="refreshTimer" style="font-size: 14px; color: var(--text-light); margin-left: auto;">
                –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑: 3 —Å–µ–∫
            </span>
        </h2>
        
        <div class="user-list" id="onlineUsersList">
            <?php
            $deputies_file = __DIR__ . "/json/zams_inonline.json";
            $online_list = [];
            $offline_list = [];
            
            if (file_exists($deputies_file)) {
                $data = json_decode(file_get_contents($deputies_file), true);
                
                if (is_array($data)) {
                    $now = time();
                    
                    $weekly_stats = [];
                    try {
                        $stmt = $con->prepare("SELECT nick, minut FROM online_zames WHERE 1");
                        $stmt->execute();
                        $stats_data = $stmt->fetchAll(PDO::FETCH_ASSOC);
                        
                        foreach ($stats_data as $stat) {
                            $weekly_stats[$stat['nick']] = $stat['minut'];
                        }
                    } catch (Exception $e) {
                        error_log("Error fetching weekly stats: " . $e->getMessage());
                    }
                    
                    foreach ($data as $nick => $last_seen) {
                        $last_seen_diff = $now - $last_seen;
                        $weekly_online = isset($weekly_stats[$nick]) ? $weekly_stats[$nick] : 0;
                        
                        if ($last_seen_diff <= 70) {
                            $online_list[$nick] = [
                                'status' => "–≤ —Å–µ—Ç–∏",
                                'weekly' => $weekly_online
                            ];
                        } else {
                            $last_seen_str = formatDuration($last_seen_diff);
                            $offline_list[$nick] = [
                                'status' => "–±—ã–ª $last_seen_str –Ω–∞–∑–∞–¥",
                                'weekly' => $weekly_online
                            ];
                        }
                    }
                }
            }
            
            function formatDuration($seconds) {
                $units = [
                    '–¥–µ–Ω—å' => 86400,
                    '—á–∞—Å' => 3600,
                    '–º–∏–Ω' => 60,
                    '—Å–µ–∫' => 1
                ];
                
                $result = [];
                foreach ($units as $name => $divisor) {
                    if ($quot = intval($seconds / $divisor)) {
                        $result[] = $quot . ' ' . $name;
                        $seconds %= $divisor;
                    }
                }
                
                return implode(' ', $result);
            }
            
            function formatWeeklyTime($minutes) {
                if ($minutes < 60) {
                    return $minutes . ' –º–∏–Ω';
                } else {
                    $hours = floor($minutes / 60);
                    $remaining_minutes = $minutes % 60;
                    if ($remaining_minutes > 0) {
                        return $hours . ' —á ' . $remaining_minutes . ' –º–∏–Ω';
                    } else {
                        return $hours . ' —á';
                    }
                }
            }
            
            if (!empty($online_list)) {
                foreach($online_list as $nick => $data): ?>
                <div class="user-card">
                    <div class="user-header">
                        <div class="user-name"><?php echo htmlspecialchars($nick); ?></div>
                        <div class="user-status status-online">
                            <?php echo $data['status']; ?>
                        </div>
                    </div>
                    <div class="user-stats">
                        <span class="weekly-stats">–û–Ω–ª–∞–π–Ω –∑–∞ –Ω–µ–¥–µ–ª—é: <?php echo formatWeeklyTime($data['weekly']); ?></span>
                    </div>
                </div>
                <?php endforeach;
            }
            
            if (!empty($offline_list)) {
                foreach($offline_list as $nick => $data): ?>
                <div class="user-card">
                    <div class="user-header">
                        <div class="user-name"><?php echo htmlspecialchars($nick); ?></div>
                        <div class="user-status status-offline">
                            <?php echo $data['status']; ?>
                        </div>
                    </div>
                    <div class="user-stats">
                        <span class="weekly-stats">–û–Ω–ª–∞–π–Ω –∑–∞ –Ω–µ–¥–µ–ª—é: <?php echo formatWeeklyTime($data['weekly']); ?></span>
                    </div>
                </div>
                <?php endforeach;
            }
            ?>
        </div>
    </section>

<?php
$stmt = $con->prepare("SELECT * FROM tg_nlist WHERE tg_id = ?");
$stmt->execute([$from_id]);
$sitecheck = $stmt->fetch(PDO::FETCH_ASSOC);
if ($from_id && $sitecheck && $sitecheck['is_admin'] >= 1): ?>
<section class="card">
    <h2>–î–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
    
    <div class="action-section">
        <form class="action-form" id="userActionForm">
            <div class="form-group">
                <label class="form-label">–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" name="target_nick" class="form-input" placeholder="–ù–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            </div>
            <div class="action-buttons">
                <button type="button" class="btn purple" onclick="openModal('rankModal')">
                    –°–º–µ–Ω–∏—Ç—å —Ä–∞–Ω–≥
                </button>
                <button type="button" class="btn warning" onclick="openModal('warningModal')">
                    –í—ã–¥–∞—Ç—å –≤—ã–≥–æ–≤–æ—Ä
                </button>
                <button type="button" class="btn warning" onclick="openModal('muteModal')">
                    –í—ã–¥–∞—Ç—å –±–∞–Ω —á–∞—Ç–∞
                </button>
                <button type="button" class="btn danger" onclick="openModal('banModal')">
                    –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button type="button" class="btn danger" onclick="openModal('kickModal')">
                    –ò—Å–∫–ª—é—á–∏—Ç—å –∏–∑ —Å–µ–º—å–∏
                </button>
            </div>
        </form>
    </div>
</section>
<?php if ($sitecheck['is_admin'] >= 1): ?>
<?php
$modals = [
    '404'=>['title'=>'404','fields'=>[
    ]],
    'warningModal'=>['title'=>'–í—ã–¥–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ','fields'=>[
        ['label'=>'–ù–∏–∫','name'=>'target_nick','type'=>'text','required'=>true],
        ['label'=>'–ü—Ä–∏—á–∏–Ω–∞','name'=>'warning_reason','type'=>'text','required'=>true]
    ]],
    'muteModal'=>['title'=>'–í—ã–¥–∞—Ç—å —Å–µ–º–µ–π–Ω—ã–π –º—É—Ç','fields'=>[
        ['label'=>'–ù–∏–∫','name'=>'target_nick','type'=>'text','required'=>true],
        ['label'=>'–ú–∏–Ω—É—Ç—ã','name'=>'mute_minutes','type'=>'number','required'=>true,'min'=>2,'max'=>180]
    ]],
    'banModal'=>['title'=>'–í—ã–¥–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É','fields'=>[
        ['label'=>'–ù–∏–∫','name'=>'target_nick','type'=>'text','required'=>true],
        ['label'=>'–ü—Ä–∏—á–∏–Ω–∞','name'=>'ban_reason','type'=>'text','required'=>true]
    ]],
    'kickModal'=>['title'=>'–ö–∏–∫–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è','fields'=>[
        ['label'=>'–ù–∏–∫','name'=>'target_nick','type'=>'text','required'=>true]
    ]],
    'rankModal'=>['title'=>'–°–º–µ–Ω–∏—Ç—å —Ä–∞–Ω–≥','fields'=>[
        ['label'=>'–ù–∏–∫','name'=>'target_nick','type'=>'text','required'=>true],
        ['label'=>'–ù–æ–≤—ã–π —Ä–∞–Ω–≥','name'=>'rank','type'=>'select','options'=>[
            '' => '-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–Ω–≥ --', 
            3 => 'üîß –•–æ–∑—è–µ—Ç—Ä—É–¥–Ω–∏–∫',
            4 => 'üõ°Ô∏è –•–æ–∑—è–µ—Å—Ç—Ä–∞–∂',
            5 => 'üéì –•–æ–∑—è–µ–º–∞—Å—Ç–µ—Ä',
            7 => 'üë∂ –ü—É–ø—Å–∏–∫', 
            8 => 'üí∞ $ –ú–∞–∂–æ—Ä $',
            9 => 'üëî –ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å',
            10 => 'üëë –ì–ª.–•–û–ó–ØUH',
            11 => 'üë§ –ì–ª.–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å'
        ], 'required' => true, 'default' => 3]
    ]],
];
?>

<?php foreach($modals as $id=>$modal): ?>
<div id="<?php echo $id;?>" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title"><?php echo $modal['title'];?></h3>
            <span class="close" onclick="closeModal('<?php echo $id;?>')">&times;</span>
        </div>
        
        <form class="ajax-form" data-action="<?php echo str_replace('Modal', '', $id); ?>">
            <input type="hidden" name="ajax_action" value="1">
            <input type="hidden" name="action" value="<?php echo str_replace('Modal', '', $id); ?>">
            
            <?php foreach($modal['fields'] as $field): ?>
            <div class="form-group-modal">
                <label class="form-label-modal"><?php echo $field['label'];?></label>
                <?php if($field['type']==='select'): ?>
                <select name="<?php echo $field['name'];?>" class="form-select-modal" 
                        <?php echo ($field['required']??false)?'required':'';?>>
                    <?php foreach($field['options'] as $val=>$label): ?>
                    <option value="<?php echo $val;?>" 
                            <?php echo (isset($field['default']) && $field['default'] == $val)?'selected':'';?>>
                        <?php echo $label;?>
                    </option>
                    <?php endforeach;?>
                </select>
                <?php else: ?>
                <input type="<?php echo $field['type'];?>" name="<?php echo $field['name'];?>" class="form-input-modal"
                    <?php echo ($field['required']??false)?'required':'';?>
                    <?php echo isset($field['min'])?' min="'.$field['min'].'"':'';?>
                    <?php echo isset($field['max'])?' max="'.$field['max'].'"':'';?>
                    <?php echo $field['type'] === 'text' ? 'placeholder="–í–≤–µ–¥–∏—Ç–µ '.$field['label'].'"' : '';?>>
                <?php endif;?>
            </div>
            <?php endforeach;?>
            
            <div class="form-actions">
                <button type="button" class="btn danger" onclick="closeModal('<?php echo $id;?>')">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>
<?php endforeach; ?>
<?php endif; ?>

<?php else: ?>
<?php endif; ?>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tg = window.Telegram.WebApp;
    const fromIdExists = <?php echo $from_id ? 'true' : 'false'; ?>;
    
    const loadingOverlay = document.getElementById('loading-overlay');
    loadingOverlay.style.display = 'flex';
    
    setTimeout(() => {
        loadingOverlay.classList.add('hiding');
        setTimeout(() => {
            loadingOverlay.style.display = 'none';
            loadingOverlay.classList.remove('hiding');
        }, 300);
    }, 1000);
    
    document.querySelectorAll('.radio-inputs input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.checked) {
                const section = this.getAttribute('data-section');
                
                loadingOverlay.style.display = 'flex';
                
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                setTimeout(() => {
                    document.getElementById(section + '-section').classList.add('active');
                    
                    loadingOverlay.classList.add('hiding');
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                        loadingOverlay.classList.remove('hiding');
                    }, 300);
                    
                    const url = new URL(window.location);
                    url.searchParams.set('section', section);
                    window.history.replaceState({}, '', url);
                }, 500);
            }
        });
    });
    
    if (!fromIdExists) {
        if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
            const user = tg.initDataUnsafe.user;
            console.log('Telegram user found:', user.id);
            
            fetch('', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ from_id: user.id })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Data sent successfully:', data);
                if (data.success) {
                    window.location.reload();
                }
            })
            .catch(error => {
                console.error('Error sending data:', error);
                document.querySelector('main.content').innerHTML = `
                    <div class="card">
                        <h2>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
                        <button onclick="window.location.reload()" class="btn">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
                    </div>
                `;
            });
        } else {
            console.log('Telegram WebApp not initialized');
            setTimeout(() => {
                window.location.reload();
            }, 3000);
        }
    }
    
    <?php if (isset($dates) && isset($message_counts)): ?>
    const ctx = document.getElementById('messageChart');
    if (ctx) {
        const messageChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: <?php echo json_encode($dates); ?>,
                datasets: [{
                    label: '–°–æ–æ–±—â–µ–Ω–∏–π',
                    data: <?php echo json_encode($message_counts); ?>,
                    backgroundColor: 'rgba(112, 42, 204, 0.6)',
                    borderColor: 'rgba(112, 42, 204, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤
    document.querySelectorAll('.logs-filters .filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.getAttribute('data-filter');
            
            document.querySelectorAll('.logs-filters .filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            document.querySelectorAll('.log-item').forEach(item => {
                if (filter === 'all' || item.getAttribute('data-category') === filter) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–Ω–µ–π –≤ –ª–æ–≥–∞—Ö
    document.querySelectorAll('.day-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const day = this.getAttribute('data-day');
            
            document.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            document.querySelectorAll('.day-activities').forEach(dayEl => {
                dayEl.style.display = dayEl.getAttribute('data-day') === day ? 'block' : 'none';
            });
        });
    });
    <?php endif; ?>
});

let refreshTimer = 5;
let timerInterval;

function openModal(id) {
    const mainFormNick = document.querySelector('input[name="target_nick"]').value;
    const modalInput = document.querySelector('#' + id + ' input[name="target_nick"]');
    
    if (modalInput && mainFormNick) {
        modalInput.value = mainFormNick;
    }
    
    document.getElementById(id).style.display = 'block';
}

function closeModal(id) { 
    document.getElementById(id).style.display = 'none'; 
}

function showToast(message, type = 'success') {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    const icons = {
        success: '‚úÖ',
        error: '‚ùå',
        warning: '‚ö†Ô∏è'
    };
    
    toast.innerHTML = `
<div class="card1 ${type}">
  <svg class="wave" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M0,256L11.4,240C22.9,224,46,192,69,192C91.4,192,114,224,137,234.7C160,245,183,235,206,213.3C228.6,192,251,160,274,149.3C297.1,139,320,149,343,181.3C365.7,213,389,267,411,282.7C434.3,299,457,277,480,250.7C502.9,224,526,192,549,181.3C571.4,171,594,181,617,208C640,235,663,277,686,256C708.6,235,731,149,754,122.7C777.1,96,800,128,823,165.3C845.7,203,869,245,891,224C914.3,203,937,117,960,112C982.9,107,1006,181,1029,197.3C1051.4,213,1074,171,1097,144C1120,117,1143,107,1166,133.3C1188.6,160,1211,224,1234,218.7C1257.1,213,1280,139,1303,133.3C1325.7,128,1349,192,1371,192C1394.3,192,1417,128,1429,96L1440,64L1440,320L0,320Z"
      fill-opacity="1"
    ></path>
  </svg>

  <div class="icon-container">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 512 512"
      class="icon success-icon"
      style="display: ${type === 'success' ? 'block' : 'none'}"
    >
      <path
        d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z"
      ></path>
    </svg>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 15 15"
      class="icon error-icon"
      style="display: ${type === 'error' ? 'block' : 'none'}"
    >
      <path
        fill="currentColor"
        d="M11.78 4.03c.22-.22.22-.59 0-.81a.574.574 0 0 0-.81 0L7.5 6.69 4.03 3.22a.574.574 0 0 0-.81 0c-.22.22-.22.59 0 .81L6.69 7.5l-3.47 3.47a.574.574 0 0 0 0 .81c.22.22.59.22.81 0L7.5 8.31l3.47 3.47c.22.22.59.22.81 0 .22-.22.22-.59 0-.81L8.31 7.5l3.47-3.47z"
      />
    </svg>
  </div>

  <div class="message-text-container">
    <p class="message-text">${type === 'success' ? '–£—Å–ø–µ—à–Ω–æ!' : '–û—à–∏–±–∫–∞!'}</p>
    <p class="sub-text">${message}</p>
  </div>
</div>

    `;
    
    toastContainer.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    setTimeout(() => {
        toast.classList.remove('show');
        toast.classList.add('hide');
        setTimeout(() => {
            if (toast.parentElement) {
                toast.remove();
            }
        }, 300);
    }, 5000);
}

function updateOnlineStatus() {
    fetch(window.location.href, {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.text())
    .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const newUserList = doc.getElementById('onlineUsersList');
        
        if (newUserList) {
            document.getElementById('onlineUsersList').innerHTML = newUserList.innerHTML;
        }
        
        refreshTimer = 5;
        updateTimerDisplay();
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞', 'error');
    });
}

function updateTimerDisplay() {
    const timerElement = document.getElementById('refreshTimer');
    if (timerElement) {
        timerElement.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑: ${refreshTimer} —Å–µ–∫`;
    }
}

async function handleFormSubmit(form, action) {
    console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã:', action);
    
    const requiredInputs = form.querySelectorAll('[required]');
    let isValid = true;
    
    requiredInputs.forEach(input => {
        console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è:', input.name, '–∑–Ω–∞—á–µ–Ω–∏–µ:', input.value);
        if (!input.value.trim()) {
            isValid = false;
            input.style.borderColor = 'red';
            console.log('–ü–æ–ª–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ:', input.name);
        } else {
            input.style.borderColor = '';
        }
    });
    
    if (!isValid) {
        showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
        return;
    }
    
    const formData = new FormData(form);
    formData.append('ajax', 1);
    
    for (let [key, value] of formData.entries()) {
        console.log(key + ': ' + value);
    }
    
    const submitButton = form.querySelector('button[type="submit"]');
    const originalText = submitButton.innerHTML;
    submitButton.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...'; 
    submitButton.disabled = true;

    try {
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
        const response = await fetch('', {
            method: 'POST', 
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
        
        console.log('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, —Å—Ç–∞—Ç—É—Å:', response.status);
        const result = await response.json();
        console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
        
        if(result.success){
            showToast(result.message,'success');
            closeModal(action+'Modal');
        }else{
            showToast(result.message,'error');
        }
    } catch(e){
        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', e);
        showToast('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏','error');
    } finally{
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.ajax-form').forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const action = this.getAttribute('data-action');
            handleFormSubmit(this, action);
        });
    });
    
    updateTimerDisplay();
    timerInterval = setInterval(function() {
        refreshTimer--;
        updateTimerDisplay();
        
        if (refreshTimer <= 0) {
            updateOnlineStatus();
        }
    }, 1000);
    
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal(this.id);
            }
        });
    });
});

window.addEventListener('beforeunload', function() {
    if (timerInterval) {
        clearInterval(timerInterval);
    }
});
</script>

</body>
</html>